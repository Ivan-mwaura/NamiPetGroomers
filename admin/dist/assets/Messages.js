import{r as a,q as F,j as s,t as N,v,b as T,B as k}from"./index.js";import"./CustomTextField.js";import{C as E}from"./CustomTable.js";import{D as w,a as A,b as B,c as I}from"./DialogTitle.js";import"./CustomButton.js";import"./index.esm.js";import"./MenuItem.js";const G=()=>{const[m,h]=a.useState(1),l=7,{messages:n}=a.useContext(F),[t,r]=a.useState(null),[x,i]=a.useState(""),[g,o]=a.useState(""),[f,c]=a.useState(null),[C,d]=a.useState(!1),b=()=>{h(e=>e+1)},S=()=>{h(e=>Math.max(e-1,1))},p=n.data.map(e=>({_id:e._id,firstName:e.firstName,lastName:e.lastName,selectedService:e.selectedService,email:e.email,phoneNo:e.phoneNo,message:e.message})),j=(m-1)*l,D=p==null?void 0:p.slice(j,j+l),M=[{label:"First Name",field:"firstName"},{label:"Last Name",field:"lastName"},{label:"Selected Service",field:"selectedService"},{label:"Email",field:"email"},{label:"Phone Number",field:"phoneNo"},{label:"Message",field:"message"}],P=e=>{r(e),d(!0)},R=async()=>{if(!t)return;const e=new FormData;e.append("email",t.email),e.append("subject",g),e.append("reply",x),f&&e.append("attachment",f);try{await T.post("http://localhost:5000/api/v1/sendReply",e,{headers:{"Content-Type":"multipart/form-data"}}).then(u=>{u.status===200&&k.success("Reply sent successfully!")}),i(""),o(""),c(null),r(null),d(!1)}catch(u){console.error("Error sending reply:",u),alert("Failed to send reply.")}},y=()=>{d(!1),r(null),i(""),o(""),c(null)};return s.jsxs("div",{className:"Messages DisplayFlex",children:[s.jsxs("div",{className:"Header",children:[s.jsx("span",{children:"Dashboard"})," ",s.jsx("i",{className:"fas fa-angle-right"})," ",s.jsx("span",{children:"Messages"})]}),s.jsxs("div",{className:"MessagesContainer DisplayFlex",children:[s.jsx("div",{className:"MessagesTop DisplayFlex",children:s.jsx("div",{className:"Filter DisplayFlex"})}),s.jsx("div",{className:"MessagesBottom",children:s.jsx(E,{data:D,columns:M,currentPage:m,totalItems:n==null?void 0:n.data.length,messagesPerPage:l,usersPerPage:l,handleNextPage:b,handlePreviousPage:S,context:"messages",onReplyClick:P})})]}),s.jsxs(w,{open:C,onClose:y,children:[s.jsxs(A,{children:["Reply to ",t==null?void 0:t.email]}),s.jsxs(B,{children:[s.jsx(N,{label:"Subject",fullWidth:!0,value:g,onChange:e=>o(e.target.value),variant:"outlined",margin:"dense"}),s.jsx(N,{label:"Reply Message",multiline:!0,rows:4,fullWidth:!0,value:x,onChange:e=>i(e.target.value),variant:"outlined",margin:"dense"}),s.jsx("input",{type:"file",onChange:e=>c(e.target.files[0])})]}),s.jsxs(I,{children:[s.jsx(v,{onClick:y,color:"secondary",children:"Cancel"}),"     ",s.jsx(v,{onClick:R,color:"primary",children:"Send Reply"})]})]})]})};export{G as default};
