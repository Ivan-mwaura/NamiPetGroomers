import{r as s,w as T,j as t,x as b,y as j,b as k,B}from"./index.js";import"./CustomButton.js";import{C as I}from"./CustomTable.js";import{D as L,a as W,b as _,c as H}from"./DialogTitle.js";import{A as O}from"./Avatar.js";import"./index.esm.js";import"./MenuItem.js";const V=()=>{const[p,m]=s.useState(1),l=7,{subscribers:P}=s.useContext(T),[n,o]=s.useState(null),[h,r]=s.useState(""),[x,c]=s.useState(""),[g,d]=s.useState(null),[S,u]=s.useState(!1),C=()=>{m(e=>e+1)},v=()=>{m(e=>Math.max(e-1,1))},R=e=>{const a=new Date,M=new Date(e)-a;return Math.ceil(M/(1e3*60*60*24))},i=P.data.map(e=>{const a=R(e.subscriptionEndDate),D=a>0?`${a} days left`:"Expired";return{_id:e._id,name:e.name,email:e.email,amount:e.amount,phoneNumber:e.phoneNumber,subscriptionPlan:e.subscriptionPlan,subscriptionEndDate:e.subscriptionEndDate,subscriptionDate:e.subscriptionDate,status:D,daysRemaining:a}}),f=(p-1)*l,N=i.slice(f,f+l),A=e=>{if(!e)return"";const a=e.split(" ");return a[0].charAt(0)+a[a.length-1].charAt(0)},E=[{label:"Profile Picture",field:"profilePicture",render:(e,a)=>t.jsx(O,{children:A(a.name)})},{label:"Name",field:"name"},{label:"Email",field:"email"},{label:"Phone Number",field:"phoneNumber"},{label:"Amount",field:"amount"},{label:"Subscription Plan",field:"subscriptionPlan"},{label:"Subscription Date",field:"subscriptionDate",render:e=>new Date(e).toLocaleDateString()},{label:"Subscription End Date",field:"subscriptionEndDate",render:e=>new Date(e).toLocaleDateString()},{label:"Status",field:"status",render:(e,a)=>t.jsx("span",{style:{color:a.daysRemaining>0?"blue":"red"},children:e})}],w=e=>{o(e),u(!0)},F=async()=>{if(!n)return;const e=new FormData;e.append("email",n.email),e.append("subject",x),e.append("reply",h),g&&e.append("attachment",g);try{await k.post("http://localhost:5000/api/v1/sendReply",e,{headers:{"Content-Type":"multipart/form-data"}}).then(a=>{a.status===200&&B.success("Reply sent successfully!")}),r(""),c(""),d(null),o(null),u(!1)}catch(a){console.error("Error sending reply:",a),alert("Failed to send reply.")}},y=()=>{u(!1),o(null),r(""),c(""),d(null)};return t.jsxs("div",{className:"Accomodations DisplayFlex",children:[t.jsxs("div",{className:"Header",children:[t.jsx("span",{children:"Dashboard"})," ",t.jsx("i",{className:"fas fa-angle-right"})," ",t.jsx("span",{children:"Subscribers"})]}),t.jsxs("div",{className:"AccomodationsContainer DisplayFlex",children:[t.jsx("div",{className:"AccomodationsTop DisplayFlex",children:t.jsx("div",{className:"Filter DisplayFlex"})}),t.jsx("div",{className:"AccomodationsBottom",children:t.jsx(I,{data:N,columns:E,currentPage:p,totalItems:i==null?void 0:i.length,usersPerPage:l,accomodationsPerPage:l,handleNextPage:C,handlePreviousPage:v,context:"subscribers",onReplyClick:w})})]}),t.jsxs(L,{open:S,onClose:y,children:[t.jsxs(W,{children:["Reply to ",n==null?void 0:n.email]}),t.jsxs(_,{children:[t.jsx(b,{label:"Subject",fullWidth:!0,value:x,onChange:e=>c(e.target.value),variant:"outlined",margin:"dense"}),t.jsx(b,{label:"Reply Message",multiline:!0,rows:4,fullWidth:!0,value:h,onChange:e=>r(e.target.value),variant:"outlined",margin:"dense"}),t.jsx("input",{type:"file",onChange:e=>d(e.target.files[0])})]}),t.jsxs(H,{children:[t.jsx(j,{onClick:y,color:"secondary",children:"Cancel"}),"     ",t.jsx(j,{onClick:F,color:"primary",children:"Send Reply"})]})]})]})};export{V as default};
